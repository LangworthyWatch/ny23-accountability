<!DOCTYPE html>
<html lang="en-us">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">

  <title>{{ if .IsHome }}{{ .Site.Title }}{{ else }}{{ .Title }} | {{ .Site.Title }}{{ end }}</title>
  <meta name="description" content="{{ with .Description }}{{ . }}{{ else }}{{ .Site.Params.description }}{{ end }}">

  {{/* Canonical URL */}}
  <link rel="canonical" href="{{ .Permalink }}">

  {{/* Open Graph */}}
  <meta property="og:title" content="{{ if .IsHome }}{{ .Site.Title }}{{ else }}{{ .Title }}{{ end }}">
  <meta property="og:description" content="{{ with .Description }}{{ . }}{{ else }}{{ .Site.Params.description }}{{ end }}">
  <meta property="og:type" content="{{ if .IsPage }}article{{ else }}website{{ end }}">
  <meta property="og:url" content="{{ .Permalink }}">
  <meta property="og:site_name" content="{{ .Site.Title }}">
  <meta property="og:image" content="{{ .Site.BaseURL }}images/ny23_og_v6_1200x630.png?v=2">
  <meta property="og:image:width" content="1095">
  <meta property="og:image:height" content="615">
  <meta property="og:image:alt" content="LangworthyWatch.org — Accountability for the Southern Tier — New York's 23rd Congressional District">

  {{/* Twitter Card */}}
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="{{ if .IsHome }}{{ .Site.Title }}{{ else }}{{ .Title }}{{ end }}">
  <meta name="twitter:description" content="{{ with .Description }}{{ . }}{{ else }}{{ .Site.Params.description }}{{ end }}">
  <meta name="twitter:image" content="{{ .Site.BaseURL }}images/ny23_og_v6_1200x630.png?v=2">
  <meta name="twitter:image:alt" content="LangworthyWatch.org — Accountability for the Southern Tier — New York's 23rd Congressional District">

  {{/* Robots */}}
  <meta name="robots" content="index, follow">

  {{/* Favicon */}}
  <link rel="icon" href="/favicon.ico" type="image/x-icon">

  {{/* CSS - Using Hugo Pipes for asset processing */}}
  {{ $css := resources.Get "css/bundle.css" }}
  {{ $cssBundle := $css | resources.Minify | resources.Fingerprint }}
  <link rel="stylesheet" href="{{ $cssBundle.Permalink }}">

  {{/* Google Analytics */}}
  {{ with .Site.Params.googleAnalyticsId }}
  <script async src="https://www.googletagmanager.com/gtag/js?id={{ . }}"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', '{{ . }}');
  </script>
  {{ end }}

  {{/* Donorbox widget script */}}
  <script type="module" src="https://donorbox.org/widgets.js" async></script>
</head>
<body class="site-wrapper">
  {{/* Skip navigation link */}}
  <a href="#main-content" class="skip-link">Skip to main content</a>

  {{/* Header */}}
  {{ partial "header.html" . }}

  {{/* Mobile navigation */}}
  {{ partial "nav-mobile.html" . }}

  {{/* Main content */}}
  <main id="main-content" class="site-main" role="main">
    {{ block "main" . }}{{ end }}
  </main>

  {{/* Footer */}}
  {{ partial "footer.html" . }}

  {{/* Mobile nav JavaScript */}}
  <script>
    (function() {
      var toggle = document.getElementById('nav-toggle');
      var close = document.getElementById('nav-close');
      var nav = document.getElementById('nav-mobile');

      if (toggle && nav) {
        // Get all focusable elements within the mobile nav
        function getFocusableElements() {
          return nav.querySelectorAll('button, a[href], input, select, textarea, [tabindex]:not([tabindex="-1"])');
        }

        // Focus trap handler - keeps Tab cycling within the mobile menu
        function handleFocusTrap(e) {
          if (e.key !== 'Tab' || !nav.classList.contains('is-open')) return;

          var focusable = getFocusableElements();
          if (focusable.length === 0) return;

          var first = focusable[0];
          var last = focusable[focusable.length - 1];

          if (e.shiftKey) {
            // Shift+Tab: if on first element, wrap to last
            if (document.activeElement === first) {
              e.preventDefault();
              last.focus();
            }
          } else {
            // Tab: if on last element, wrap to first
            if (document.activeElement === last) {
              e.preventDefault();
              first.focus();
            }
          }
        }

        toggle.addEventListener('click', function() {
          nav.classList.add('is-open');
          nav.setAttribute('aria-hidden', 'false');
          toggle.setAttribute('aria-expanded', 'true');
          close.focus();
          document.body.style.overflow = 'hidden';
        });

        close.addEventListener('click', function() {
          nav.classList.remove('is-open');
          nav.setAttribute('aria-hidden', 'true');
          toggle.setAttribute('aria-expanded', 'false');
          toggle.focus();
          document.body.style.overflow = '';
        });

        // Handle keyboard events
        document.addEventListener('keydown', function(e) {
          // Close on Escape
          if (e.key === 'Escape' && nav.classList.contains('is-open')) {
            nav.classList.remove('is-open');
            nav.setAttribute('aria-hidden', 'true');
            toggle.setAttribute('aria-expanded', 'false');
            toggle.focus();
            document.body.style.overflow = '';
            return;
          }

          // Focus trap on Tab
          handleFocusTrap(e);
        });
      }
    })();
  </script>
</body>
</html>
